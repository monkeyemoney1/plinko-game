<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 8px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .result { background: #e9ecef; padding: 15px; margin: 10px 0; border-radius: 4px; white-space: pre-wrap; }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .status-pending { color: #ffc107; font-weight: bold; }
        .status-completed { color: #28a745; font-weight: bold; }
        .status-failed { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üèß –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ TON</h1>
    
    <!-- –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="container">
        <h3>üí∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <input type="number" id="userIdBalance" placeholder="User ID" value="1">
        <button onclick="checkBalance()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        <div id="balanceResult" class="result"></div>
    </div>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–≤–æ–¥ -->
    <div class="container">
        <h3>üì§ –°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥</h3>
        <input type="number" id="userIdWithdraw" placeholder="User ID" value="1">
        <input type="number" id="withdrawAmount" placeholder="–°—É–º–º–∞ (TON)" value="0.5" step="0.1">
        <input type="text" id="withdrawWallet" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞" value="UQBvW8Z5huBkMJYdnfAEM5JqTNkuWX3diqYENkWsIL0XggGG">
        <button onclick="createWithdrawal()">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥</button>
        <div id="withdrawResult" class="result"></div>
    </div>

    <!-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≤–æ–¥–∞ -->
    <div class="container">
        <h3>‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–≤–æ–¥</h3>
        <input type="number" id="processWithdrawalId" placeholder="Withdrawal ID">
        <button onclick="processWithdrawal()">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–≤–æ–¥</button>
        <div id="processResult" class="result"></div>
    </div>

    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–≤–æ–¥–æ–≤ -->
    <div class="container">
        <h3>üìä –°—Ç–∞—Ç—É—Å –≤—ã–≤–æ–¥–æ–≤</h3>
        <input type="number" id="userIdStatus" placeholder="User ID" value="1">
        <button onclick="checkWithdrawals()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–≤–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <br>
        <input type="number" id="withdrawalIdStatus" placeholder="Withdrawal ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
        <button onclick="checkSpecificWithdrawal()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤—ã–≤–æ–¥</button>
        <div id="statusResult" class="result"></div>
    </div>

    <script>
        async function makeRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (data) options.body = JSON.stringify(data);
                
                const response = await fetch(url, options);
                const result = await response.json();
                
                return {
                    status: response.status,
                    data: result,
                    timestamp: new Date().toLocaleTimeString()
                };
            } catch (error) {
                return {
                    status: 'ERROR',
                    data: { error: error.message },
                    timestamp: new Date().toLocaleTimeString()
                };
            }
        }

        function displayResult(elementId, result, title = '') {
            const element = document.getElementById(elementId);
            const className = result.data.success ? 'success' : 'error';
            element.className = `result ${className}`;
            element.textContent = `${title}\nStatus: ${result.status}\nTime: ${result.timestamp}\n\n` + 
                                 JSON.stringify(result.data, null, 2);
        }

        async function checkBalance() {
            const userId = document.getElementById('userIdBalance').value;
            const result = await makeRequest(`/api/users/${userId}`);
            displayResult('balanceResult', result, '–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:');
        }

        async function createWithdrawal() {
            const userId = document.getElementById('userIdWithdraw').value;
            const amount = document.getElementById('withdrawAmount').value;
            const walletAddress = document.getElementById('withdrawWallet').value;
            
            const result = await makeRequest('/api/withdrawals/create', 'POST', {
                user_id: parseInt(userId),
                amount: parseFloat(amount),
                wallet_address: walletAddress
            });
            
            displayResult('withdrawResult', result, '–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–≤–æ–¥:');
            
            // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
            if (result.data.success && result.data.withdrawal) {
                document.getElementById('processWithdrawalId').value = result.data.withdrawal.id;
                setTimeout(() => {
                    processWithdrawal();
                }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞
            }
        }

        async function processWithdrawal() {
            const withdrawalId = document.getElementById('processWithdrawalId').value;
            const result = await makeRequest('/api/withdrawals/process', 'POST', {
                withdrawal_id: parseInt(withdrawalId)
            });
            displayResult('processResult', result, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≤–æ–¥–∞:');
        }

        async function checkWithdrawals() {
            const userId = document.getElementById('userIdStatus').value;
            const result = await makeRequest(`/api/withdrawals/status?user_id=${userId}`);
            displayResult('statusResult', result, '–í—ã–≤–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:');
        }

        async function checkSpecificWithdrawal() {
            const withdrawalId = document.getElementById('withdrawalIdStatus').value;
            if (!withdrawalId) {
                alert('–í–≤–µ–¥–∏—Ç–µ Withdrawal ID');
                return;
            }
            const result = await makeRequest(`/api/withdrawals/status?withdrawal_id=${withdrawalId}`);
            displayResult('statusResult', result, '–°—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:');
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        window.onload = function() {
            checkBalance();
        };
    </script>
</body>
</html>