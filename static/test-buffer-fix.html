<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buffer Polyfill Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .test-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    .test-result {
      margin: 15px 0;
      padding: 15px;
      border-radius: 8px;
      font-size: 16px;
    }
    .success {
      background: rgba(76, 175, 80, 0.3);
      border-left: 4px solid #4CAF50;
    }
    .error {
      background: rgba(244, 67, 54, 0.3);
      border-left: 4px solid #f44336;
    }
    .info {
      background: rgba(33, 150, 243, 0.3);
      border-left: 4px solid #2196F3;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
    }
    .test-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 20px 0;
      cursor: pointer;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      width: 100%;
    }
    .test-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üîß –¢–µ—Å—Ç Buffer Polyfill</h1>
    
    <div id="results"></div>
    
    <button class="test-button" onclick="runTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    
    <div class="test-result info">
      <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
      –≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É Buffer polyfill –≤ –±—Ä–∞—É–∑–µ—Ä–µ.<br>
      –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ "Buffer is not defined" —Ä–µ—à–µ–Ω–∞!
    </div>
  </div>

  <script type="module">
    // Import Buffer first
    import { Buffer } from 'buffer';
    
    // Make it globally available
    window.Buffer = Buffer;
    globalThis.Buffer = Buffer;
    
    console.log('‚úÖ Buffer polyfill loaded successfully');
    
    window.runTests = function() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:</h2>';
      
      const tests = [];
      
      // Test 1: Check if Buffer exists
      try {
        if (typeof Buffer !== 'undefined') {
          tests.push({ name: 'Buffer —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏', status: 'success' });
        } else {
          tests.push({ name: 'Buffer —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏', status: 'error', error: 'Buffer is undefined' });
        }
      } catch (e) {
        tests.push({ name: 'Buffer —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏', status: 'error', error: e.message });
      }
      
      // Test 2: Check if Buffer.from works
      try {
        const buf = Buffer.from('Hello World', 'utf8');
        if (buf && buf.length === 11) {
          tests.push({ name: 'Buffer.from() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'success' });
        } else {
          tests.push({ name: 'Buffer.from() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'error', error: 'Invalid buffer length' });
        }
      } catch (e) {
        tests.push({ name: 'Buffer.from() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'error', error: e.message });
      }
      
      // Test 3: Check if Buffer.alloc works
      try {
        const buf = Buffer.alloc(10);
        if (buf && buf.length === 10) {
          tests.push({ name: 'Buffer.alloc() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'success' });
        } else {
          tests.push({ name: 'Buffer.alloc() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'error', error: 'Invalid buffer length' });
        }
      } catch (e) {
        tests.push({ name: 'Buffer.alloc() —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', status: 'error', error: e.message });
      }
      
      // Test 4: Check globalThis
      try {
        if (typeof globalThis !== 'undefined' && globalThis.Buffer) {
          tests.push({ name: 'globalThis.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'success' });
        } else {
          tests.push({ name: 'globalThis.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'error', error: 'globalThis.Buffer is undefined' });
        }
      } catch (e) {
        tests.push({ name: 'globalThis.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'error', error: e.message });
      }
      
      // Test 5: Check window.Buffer
      try {
        if (typeof window !== 'undefined' && window.Buffer) {
          tests.push({ name: 'window.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'success' });
        } else {
          tests.push({ name: 'window.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'error', error: 'window.Buffer is undefined' });
        }
      } catch (e) {
        tests.push({ name: 'window.Buffer –¥–æ—Å—Ç—É–ø–µ–Ω', status: 'error', error: e.message });
      }
      
      // Test 6: Test Buffer with TON-like operations
      try {
        // Simulate TON BitString-like operation
        const testData = 'test_data_for_ton';
        const buf = Buffer.from(testData, 'utf8');
        const hex = buf.toString('hex');
        const base64 = buf.toString('base64');
        
        if (hex && base64) {
          tests.push({ name: 'Buffer –æ–ø–µ—Ä–∞—Ü–∏–∏ (hex, base64) —Ä–∞–±–æ—Ç–∞—é—Ç', status: 'success' });
        } else {
          tests.push({ name: 'Buffer –æ–ø–µ—Ä–∞—Ü–∏–∏ (hex, base64) —Ä–∞–±–æ—Ç–∞—é—Ç', status: 'error', error: 'Invalid conversion' });
        }
      } catch (e) {
        tests.push({ name: 'Buffer –æ–ø–µ—Ä–∞—Ü–∏–∏ (hex, base64) —Ä–∞–±–æ—Ç–∞—é—Ç', status: 'error', error: e.message });
      }
      
      // Display results
      tests.forEach(test => {
        const div = document.createElement('div');
        div.className = `test-result ${test.status}`;
        
        if (test.status === 'success') {
          div.innerHTML = `<strong>‚úÖ ${test.name}</strong>`;
        } else {
          div.innerHTML = `<strong>‚ùå ${test.name}</strong><br><code>${test.error}</code>`;
        }
        
        resultsDiv.appendChild(div);
      });
      
      // Summary
      const successCount = tests.filter(t => t.status === 'success').length;
      const totalCount = tests.length;
      const summaryDiv = document.createElement('div');
      summaryDiv.className = 'test-result ' + (successCount === totalCount ? 'success' : 'error');
      summaryDiv.innerHTML = `<strong>–ò—Ç–æ–≥–æ: ${successCount}/${totalCount} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</strong>`;
      resultsDiv.appendChild(summaryDiv);
      
      console.log('Tests completed:', tests);
    };
    
    // Auto-run tests on load
    setTimeout(() => {
      runTests();
    }, 500);
  </script>
</body>
</html>
