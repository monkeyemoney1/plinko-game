# ๐ธ ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฒะพะด ััะตะดััะฒ

## โจ ะงัะพ ะธะทะผะตะฝะธะปะพัั

### ๐ ะะณะฝะพะฒะตะฝะฝัะน ะฒัะฒะพะด
ะขะตะฟะตัั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐัะฒะบะธ ะฝะฐ ะฒัะฒะพะด ััะตะดััะฒะฐ **ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะฟัะฐะฒะปััััั** ัะตัะตะท ะฑะปะพะบัะตะนะฝ TON!

**ะัะปะพ:**
1. ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐัั ะทะฐัะฒะบั โ ะกัะฐััั: "ะ ะพะถะธะดะฐะฝะธะธ"
2. ะะดะผะธะฝ ะพะดะพะฑััะตั โ ะกัะฐััั: "ะ ะพะฑัะฐะฑะพัะบะต"
3. ะกะธััะตะผะฐ ะพัะฟัะฐะฒะปัะตั TON โ ะกัะฐััั: "ะะฐะฒะตััะตะฝะพ"

**ะกัะฐะปะพ:**
1. ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐัั ะทะฐัะฒะบั โ **ะะณะฝะพะฒะตะฝะฝะพ ะพัะฟัะฐะฒะปัะตะผ TON** โ ะกัะฐััั: "ะะฐะฒะตััะตะฝะพ" โ

### ๐ฐ ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ะบะพะผะธััะธั 0.05 TON

**ะัะปะพ:**
- ะคะธะบัะธัะพะฒะฐะฝะฝะฐั: 0.01 TON
- ะัะพัะตะฝัะฝะฐั: 2%
- ะัะพะณะพะฒะฐั = max(0.01, ััะผะผะฐ ร 2%)

**ะกัะฐะปะพ:**
- **ะคะธะบัะธัะพะฒะฐะฝะฝะฐั: 0.05 TON**
- ะัะพัะตะฝัะฝะฐั: ะพัะบะปััะตะฝะฐ
- **ะัะพะณะพะฒะฐั = ะฒัะตะณะดะฐ 0.05 TON**

ะัะธะผะตัั:
- ะัะฒะพะด 1 TON โ ะะพะผะธััะธั 0.05 TON โ ะะพะปััะธัะต 0.95 TON
- ะัะฒะพะด 10 TON โ ะะพะผะธััะธั 0.05 TON โ ะะพะปััะธัะต 9.95 TON
- ะัะฒะพะด 100 TON โ ะะพะผะธััะธั 0.05 TON โ ะะพะปััะธัะต 99.95 TON

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฒะพะด

### 1. ะกะพะทะดะฐะฝะธะต ะทะฐัะฒะบะธ
```typescript
POST /api/withdrawals/create
{
  "user_id": 123,
  "amount": 10,
  "wallet_address": "UQB..."
}
```

### 2. ะัะพะฒะตัะบะธ ัะธััะตะผั
- โ ะะฐะปะฐะฝั ะฟะพะปัะทะพะฒะฐัะตะปั (ััะผะผะฐ + 0.05 ะบะพะผะธััะธั)
- โ ะะฝะตะฒะฝัะต ะปะธะผะธัั
- โ ะะพะทัะฐัั ะฐะบะบะฐัะฝัะฐ
- โ ะะฐะปะธะดะฝะพััั ะฐะดัะตัะฐ ะบะพัะตะปัะบะฐ

### 3. ะะตะทะตัะฒะธัะพะฒะฐะฝะธะต ััะตะดััะฒ
ะกัะตะดััะฒะฐ ััะฐะทั ัะฟะธััะฒะฐัััั ั ะฑะฐะปะฐะฝัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั

### 4. ะัะฟัะฐะฒะบะฐ ะฒ ะฑะปะพะบัะตะนะฝ TON
```
[Withdrawal 123] Starting automatic TON transfer...
[TON Transfer] Wallet balance: 500 TON
[TON Transfer] Current seqno: 42
[TON Transfer] Transaction sent, waiting for confirmation...
[TON Transfer] Transaction confirmed! New seqno: 43
[Withdrawal 123] Successfully completed! TX: a1b2c3d4...
```

### 5. ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ
- โ ะฃัะฟะตั โ ะกัะฐััั: "completed", ัะพััะฐะฝัะตะผ TX hash
- โ ะัะธะฑะบะฐ โ ะกัะฐััั: "failed", ะฒะพะทะฒัะฐัะฐะตะผ ััะตะดััะฒะฐ

## ๐ ะะพะฒัะน ัะปะพั ะฒัะฒะพะดะฐ

```
ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั "ะัะฒะตััะธ"
         โ
ะัะพะฒะตัะบะฐ ะฑะฐะปะฐะฝัะฐ ะธ ะปะธะผะธัะพะฒ
         โ
   ะะฐะปะฐะฝั - (ััะผะผะฐ + 0.05)
         โ
ะกะพะทะดะฐะฝะธะต ะทะฐะฟะธัะธ ะฒ ะะ (status: pending)
         โ
ะกัะฐััั โ processing
         โ
    ะัะฟัะฐะฒะบะฐ TON ัะตัะตะท ะฑะปะพะบัะตะนะฝ
         โ
    โโโโโโโโโโโดโโโโโโโโโโ
    โ                   โ
  ะฃัะฟะตั              ะัะธะฑะบะฐ
    โ                   โ
completed           failed
TX hash          ะะพะทะฒัะฐั ััะตะดััะฒ
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### ะคะฐะนะป: `src/lib/config/withdrawals.ts`

```typescript
export const WITHDRAWAL_CONFIG = {
  // ะะพะผะธััะธะธ
  FIXED_FEE: 0.05,        // โ ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ะบะพะผะธััะธั
  PERCENTAGE_FEE: 0,      // โ ะัะบะปััะตะฝะฐ
  
  // ะะฒัะพะพะฑัะฐะฑะพัะบะฐ
  AUTO_PROCESS_ENABLED: true,
  AUTO_PROCESS_THRESHOLD: 999999,  // โ ะัะต ะฒัะฒะพะดั ะฐะฒัะพะผะฐัะธัะตัะบะธ
  MANUAL_REVIEW_THRESHOLD: 999999, // โ ะััะฝะฐั ะฟัะพะฒะตัะบะฐ ะพัะบะปััะตะฝะฐ
};
```

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

```env
# TON Wallet Configuration
GAME_WALLET_MNEMONIC="24 ัะปะพะฒะฐ ะผะฝะตะผะพะฝะธะบะธ"
GAME_WALLET_ADDRESS=UQBUqJjVTapj2_4J_CMte8FWrJ2hy4WRBIJLBymMuATA2jCX
TON_NETWORK=testnet  # ะธะปะธ mainnet
TON_API_KEY=your_api_key
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะัะพะฒะตัะบะธ ะฟะตัะตะด ะฒัะฒะพะดะพะผ
1. **ะะฐะปะฐะฝั** - ะดะพััะฐัะพัะฝะพ ััะตะดััะฒ (ััะผะผะฐ + 0.05)
2. **ะะพะทัะฐัั ะฐะบะบะฐัะฝัะฐ** - ะผะธะฝะธะผัะผ 24 ัะฐัะฐ
3. **ะะฝะตะฒะฝัะต ะปะธะผะธัั**:
   - ะะฐะบัะธะผัะผ 500 TON ะฒ ะดะตะฝั
   - ะะฐะบัะธะผัะผ 10 ะฒัะฒะพะดะพะฒ ะฒ ะดะตะฝั
4. **ะะฐะปะธะดะฐัะธั ะฐะดัะตัะฐ** - ะบะพััะตะบัะฝัะน TON ะฐะดัะตั

### ะะฐัะธัะฐ ะพั ะฟะพัะตัะธ ััะตะดััะฒ
- ะกัะตะดััะฒะฐ ัะฟะธััะฒะฐัััั ะะะกะะ ััะฟะตัะฝะพะน ะพัะฟัะฐะฒะบะธ
- ะัะธ ะพัะธะฑะบะต ััะฐะฝะทะฐะบัะธะธ - **ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒะพะทะฒัะฐั ะฝะฐ ะฑะฐะปะฐะฝั**
- ะัะต ะพะฟะตัะฐัะธะธ ะปะพะณะธัััััั
- Transaction hash ัะพััะฐะฝัะตััั ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั

## ๐ API ะัะฒะตัั

### ะฃัะฟะตัะฝัะน ะฒัะฒะพะด
```json
{
  "success": true,
  "withdrawal": {
    "id": 123,
    "user_id": 456,
    "gross_amount": 10,
    "net_amount": 9.95,
    "fee": 0.05,
    "wallet_address": "UQB...",
    "status": "completed",
    "transaction_hash": "a1b2c3d4e5f6..."
  },
  "message": "ะกัะตะดััะฒะฐ ััะฟะตัะฝะพ ะพัะฟัะฐะฒะปะตะฝั! ะกัะผะผะฐ: 9.95 TON"
}
```

### ะัะธะฑะบะฐ ะพัะฟัะฐะฒะบะธ
```json
{
  "success": false,
  "error": "ะัะธะฑะบะฐ ะพัะฟัะฐะฒะบะธ ััะตะดััะฒ: Insufficient balance. ะกัะตะดััะฒะฐ ะฒะพะทะฒัะฐัะตะฝั ะฝะฐ ะฑะฐะปะฐะฝั."
}
```

## ๐จ UI ะะทะผะตะฝะตะฝะธั

### ะะฐะปัะบัะปััะพั ะบะพะผะธััะธะธ ะฒ ะฟัะพัะธะปะต

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะัะฒะตััะธ ััะตะดััะฒะฐ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะกัะผะผะฐ: [10] TON                    โ
โ                                     โ
โ  ะะพะผะธััะธั: 0.05 TON                 โ
โ  ะั ะฟะพะปััะธัะต: 9.95 TON              โ
โ                                     โ
โ  [ะัะฒะตััะธ ััะตะดััะฒะฐ] โโโโโโโโโโโโโโโโโค
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะะพัะปะต ะฝะฐะถะฐัะธั ะบะฝะพะฟะบะธ:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โณ ะัะฟัะฐะฒะบะฐ ััะตะดััะฒ...              โ
โ  ะะพะถะฐะปัะนััะฐ, ะฟะพะดะพะถะดะธัะต...           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ (2-5 ัะตะบัะฝะด)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ ะฃัะฟะตัะฝะพ ะพัะฟัะฐะฒะปะตะฝะพ!              โ
โ  ะกัะผะผะฐ: 9.95 TON                    โ
โ  TX: a1b2c3d4...                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะธะฑะปะธะพัะตะบะฐ TON Transfer
**ะคะฐะนะป:** `src/lib/server/ton-transfer.ts`

```typescript
export async function sendTonTransfer(
  recipientAddress: string,
  amount: number
): Promise<{ 
  success: boolean; 
  txHash?: string; 
  error?: string 
}>
```

**ะคัะฝะบัะธะพะฝะฐะป:**
- ะะพะดะบะปััะตะฝะธะต ะบ TON ัะตัะธ (testnet/mainnet)
- ะกะพะทะดะฐะฝะธะต ะบะพัะตะปัะบะฐ ะธะท ะผะฝะตะผะพะฝะธะบะธ
- ะัะพะฒะตัะบะฐ ะฑะฐะปะฐะฝัะฐ
- ะัะฟัะฐะฒะบะฐ ััะฐะฝะทะฐะบัะธะธ
- ะะถะธะดะฐะฝะธะต ะฟะพะดัะฒะตัะถะดะตะฝะธั (ะดะพ 30 ัะตะบัะฝะด)
- ะะพะปััะตะฝะธะต TX hash

### ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

```typescript
try {
  // ะัะฟัะฐะฒะบะฐ TON
  const result = await sendTonTransfer(address, amount);
  
  if (result.success) {
    // ะะฑะฝะพะฒะธัั ััะฐััั: completed
    // ะกะพััะฐะฝะธัั TX hash
  } else {
    // ะะฑะฝะพะฒะธัั ััะฐััั: failed
    // ะะตัะฝััั ััะตะดััะฒะฐ ะฝะฐ ะฑะฐะปะฐะฝั
  }
} catch (error) {
  // ะัะบะฐัะธัั ััะฐะฝะทะฐะบัะธั
  // ะะตัะฝััั ััะตะดััะฒะฐ
  // ะะพะณะธัะพะฒะฐัั ะพัะธะฑะบั
}
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ ะฒัะฒะพะดะพะฒ
```bash
[Withdrawal 123] Starting automatic TON transfer...
[TON Transfer] Wallet balance: 500 TON
[TON Transfer] Transaction sent
[TON Transfer] Transaction confirmed!
[Withdrawal 123] Successfully completed! TX: abc123
```

### ะกัะฐัััั ะฒ ะะ
- `pending` - ัะพะทะดะฐะฝะฐ ะทะฐัะฒะบะฐ (1-2 ัะตะบัะฝะดั)
- `processing` - ะพัะฟัะฐะฒะปัะตะผ TON (2-5 ัะตะบัะฝะด)
- `completed` - ััะฟะตัะฝะพ โ
- `failed` - ะพัะธะฑะบะฐ, ััะตะดััะฒะฐ ะฒะพะทะฒัะฐัะตะฝั โ

## ๐ Deployment

### ะัะธ ะดะตะฟะปะพะต ะฝะฐ Render

ะะฒัะพะผะฐัะธัะตัะบะธ:
1. ะะธะณัะฐัะธั ะะ (ัะพะทะดะฐะฝะธะต ัะฐะฑะปะธัั withdrawals)
2. ะะฐะณััะทะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
3. ะัะพะฒะตัะบะฐ GAME_WALLET_MNEMONIC
4. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

### ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

1. **ะขะตััะพะฒัะน ะฒัะฒะพะด 0.1 TON**
   ```bash
   curl -X POST https://your-app.com/api/withdrawals/create \
     -H "Content-Type: application/json" \
     -d '{
       "user_id": 1,
       "amount": 0.1,
       "wallet_address": "UQB..."
     }'
   ```

2. **ะัะพะฒะตัะบะฐ TX ะฒ ะฑะปะพะบัะตะนะฝะต**
   - Testnet: https://testnet.tonscan.org/tx/{txHash}
   - Mainnet: https://tonscan.org/tx/{txHash}

## โ๏ธ ะะฐะถะฝะพ

### ะะตะทะพะฟะฐัะฝะพััั ะผะฝะตะผะพะฝะธะบะธ
- โ **ะะ ะบะพะผะผะธัััะต** GAME_WALLET_MNEMONIC ะฒ git
- โ ะฅัะฐะฝะธัะต ัะพะปัะบะพ ะฒ ะฟะตัะตะผะตะฝะฝัั Render
- โ ะัะฟะพะปัะทัะนัะต ัะฐะทะฝัะต ะบะพัะตะปัะบะธ ะดะปั testnet/mainnet

### ะะฐะปะฐะฝั ะบะพัะตะปัะบะฐ ะธะณัั
- ะกะปะตะดะธัะต ะทะฐ ะฑะฐะปะฐะฝัะพะผ GAME_WALLET_ADDRESS
- ะัะธ ะฑะฐะปะฐะฝัะต < 100 TON ะฟะพะฟะพะปะฝะธัะต ะบะพัะตะปัะบ
- ะะฒัะพะผะฐัะธัะตัะบะธะต ะฒัะฒะพะดั ะพััะฐะฝะพะฒัััั ะตัะปะธ ะฝะตะดะพััะฐัะพัะฝะพ ััะตะดััะฒ

### ะะธะผะธัั
ะขะตะบััะธะต ะฝะฐัััะพะนะบะธ:
- ะะธะฝะธะผัะผ: 0.1 TON
- ะะฐะบัะธะผัะผ: 100 TON ะทะฐ ัะฐะท
- ะะฐะบัะธะผัะผ: 500 TON ะฒ ะดะตะฝั
- ะะฐะบัะธะผัะผ: 10 ะฒัะฒะพะดะพะฒ ะฒ ะดะตะฝั

## ๐ ะัะตะธะผััะตััะฒะฐ

โ **ะะณะฝะพะฒะตะฝะฝะพ** - ะฒัะฒะพะด ะทะฐ 2-5 ัะตะบัะฝะด  
โ **ะะฒัะพะผะฐัะธัะตัะบะธ** - ะฑะตะท ััะฐััะธั ะฐะดะผะธะฝะฐ  
โ **ะะตะทะพะฟะฐัะฝะพ** - ะฒะพะทะฒัะฐั ะฟัะธ ะพัะธะฑะบะฐั  
โ **ะัะพะทัะฐัะฝะพ** - TX hash ะดะปั ะฟัะพะฒะตัะบะธ  
โ **ะะตัะตะฒะพ** - ัะธะบัะธัะพะฒะฐะฝะฝะฐั ะบะพะผะธััะธั 0.05 TON  

---

ะขะตะฟะตัั ะฒะฐัะธ ะฟะพะปัะทะพะฒะฐัะตะปะธ ะฟะพะปััะฐัั ััะตะดััะฒะฐ ะผะณะฝะพะฒะตะฝะฝะพ! ๐
