# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Render

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ –Ω–∞ Render **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:

```json
"start": "node scripts/migrate.js && node build"
```

## üìã –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É)

1. **004_add_deposits_table.sql** - —Ç–∞–±–ª–∏—Ü–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
2. **005_add_star_transactions.sql** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Telegram Stars
3. **006_create_withdrawals_table.sql** - ‚ú® **–ù–û–í–ê–Ø** —Ç–∞–±–ª–∏—Ü–∞ –≤—ã–≤–æ–¥–æ–≤
4. **007_update_withdrawals_table.sql** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π withdrawals
5. **008_create_user_wallets_table.sql** - –∫–æ—à–µ–ª—å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ Render:

1. **Git Push** ‚Üí Render –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–¥
2. **Build** ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. **Start** ‚Üí –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `scripts/migrate.js`
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ production –ë–î
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
   - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç—ã
4. **Run** ‚Üí –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –õ–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:

```
üöÄ Starting database migration...
‚úÖ Connected to database
üìä Tables already exist: users, games, deposits, star_transactions
üìù Checking for additional migrations...
‚úÖ Migration 006_create_withdrawals_table.sql applied successfully
‚ö†Ô∏è  Migration 007_update_withdrawals_table.sql - object already exists, skipping
‚úÖ Database schema is up to date
üéâ Migration completed successfully!
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ù–µ –Ω—É–∂–µ–Ω –ø–ª–∞—Ç–Ω—ã–π Shell –Ω–∞ Render
- –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π deploy

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ó–∞–±—ã–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é? –ù–µ –ø—Ä–æ–±–ª–µ–º–∞!
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ –≤—Å—ë –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ —Ä–∞–∑)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### ‚úÖ –£–¥–æ–±–Ω–æ
- –ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç–µ `git push`
- –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–∞–º–æ

## üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

### –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª:

```bash
migrations/009_your_migration_name.sql
```

### –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:

```javascript
const migrations = [
  '004_add_deposits_table.sql',
  '005_add_star_transactions.sql',
  '006_create_withdrawals_table.sql',
  '007_update_withdrawals_table.sql',
  '008_create_user_wallets_table.sql',
  '009_your_migration_name.sql'  // ‚Üê –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
];
```

### –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ:

```bash
git add .
git commit -m "feat: add new migration"
git push
```

### –ì–æ—Ç–æ–≤–æ! 
Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ.

## üìù –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏

```sql
-- migrations/009_add_user_stats.sql

-- –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
CREATE TABLE IF NOT EXISTS user_stats (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    total_games INTEGER DEFAULT 0,
    total_won DECIMAL(15, 6) DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
CREATE INDEX IF NOT EXISTS idx_user_stats_user_id ON user_stats(user_id);
```

–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:
- `CREATE TABLE IF NOT EXISTS` - –Ω–µ —É–ø–∞–¥—ë—Ç –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ –µ—Å—Ç—å
- `CREATE INDEX IF NOT EXISTS` - –Ω–µ —É–ø–∞–¥—ë—Ç –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å —É–∂–µ –µ—Å—Ç—å
- `ALTER TABLE ... ADD COLUMN IF NOT EXISTS` - –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `IF NOT EXISTS` –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –ø—É—à–µ–º
- –ù–µ —É–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å **—Ç–∞–±–ª–∏—Ü–∞ `withdrawals` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç—Å—è** –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ –Ω–∞ Render!

–í–∞–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ:
- ‚ùå –ü–ª–∞—Ç–∏—Ç—å –∑–∞ Shell –Ω–∞ Render
- ‚ùå –í—Ä—É—á–Ω—É—é –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL
- ‚ùå –ë–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö

–ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç–µ `git push` –∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ
