# –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Plinko Game

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ)

### 1. **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ü–æ–ª—è**: id, ton_address, telegram_id, telegram_username, stars_balance, ton_balance, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: 
- –í—Å–µ API endpoints –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. **star_transactions** - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Telegram Stars
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `migrations/005_add_star_transactions.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Telegram Stars
**–ü–æ–ª—è**: id, user_id, telegram_id, amount, payload, status, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/payments/stars/initiate`
- `/api/payments/stars/verify`
- `/api/admin/analytics/stars`
- `/api/admin/transactions`

### 3. **user_wallets** - –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `migrations/006_create_user_wallets_table.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö TON –∫–æ—à–µ–ª—å–∫–æ–≤
**–ü–æ–ª—è**: id, user_id, wallet_address, is_connected, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/wallet/track-connection`
- `/api/admin/analytics/wallets`
- `/api/admin/stats`

### 4. **game_bets** - –°—Ç–∞–≤–∫–∏ –≤ –∏–≥—Ä–µ
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫
**–ü–æ–ª—è**: id, user_id, bet_amount, multiplier, payout, profit, is_win, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/bets`
- `/api/users/[id]/games`
- `/api/metrics`

### 5. **withdrawals** - –í—ã–≤–æ–¥—ã —Å—Ä–µ–¥—Å—Ç–≤
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `sql/create_withdrawals_table.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥ TON
**–ü–æ–ª—è**: id, user_id, amount, wallet_address, status, transaction_hash, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/withdrawals/create`
- `/api/withdrawals/process`
- `/api/withdrawals/status`

### 6. **deposits** - –î–µ–ø–æ–∑–∏—Ç—ã TON
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ TON
**–ü–æ–ª—è**: id, user_id, wallet_address, amount, status, transaction_hash, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/deposits/create`
- `/api/deposits/verify`
- `/api/admin/transactions`

### 7. **ton_transactions** - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ TON blockchain
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ê–ö–¢–ò–í–ù–ê**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
**–ü–æ–ª—è**: id, user_id, transaction_hash, transaction_type, amount, status, created_at
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- `/api/transactions`
- `/api/transactions/deposit`
- `/api/transactions/withdraw`
- `/api/metrics`

---

## üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

### 8. **game_sessions** - –ò–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### 9. **balance_operations** - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è/–≤—ã–≤–æ–¥–∞
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–æ–∂–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª deposits/withdrawals

### 10. **event_logs** - –õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### 11. **user_settings** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `database/schema.sql`
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ UI
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –≤ –±—É–¥—É—â–µ–º

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ù–´–ï –¢–ê–ë–õ–ò–¶–´ - –î–£–ë–õ–ò–ö–ê–¢–´

### üî¥ **game_results** vs **game_bets**
**–ü—Ä–æ–±–ª–µ–º–∞**: –í –∫–æ–¥–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è `game_results`, –Ω–æ –≤ schema.sql –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ `game_bets`
**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- `/api/admin/stats` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `game_results`
- `/api/admin/game-stats` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `game_results`
- –ù–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î —Å—É—â–µ—Å—Ç–≤—É–µ—Ç `game_bets`

**–†–µ—à–µ–Ω–∏–µ**: 
1. –õ–∏–±–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `game_bets` ‚Üí `game_results`
2. –õ–∏–±–æ –≤ –∫–æ–¥–µ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `game_results` ‚Üí `game_bets`

### üî¥ **pending_deposits** - –õ–∏—à–Ω—è—è —Ç–∞–±–ª–∏—Ü–∞?
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `migrations/003_create_pending_deposits_table.sql`
**–ü—Ä–æ–±–ª–µ–º–∞**: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–∂–µ –µ—Å—Ç—å –≤ `deposits` —á–µ—Ä–µ–∑ –ø–æ–ª–µ `status`
**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### üî¥ **blockchain_transactions** - –ü—É—Å—Ç–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
**–ò—Å—Ç–æ—á–Ω–∏–∫**: `migrations/add_blockchain_transactions.sql`
**–ü—Ä–æ–±–ª–µ–º–∞**: –§–∞–π–ª –ø—É—Å—Ç–æ–π, —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ

### 1. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
rm migrations/001_create_deposits_table.sql  # –î—É–±–ª–∏–∫–∞—Ç 004
rm migrations/002_create_deposits_tracking.sql  # –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
rm migrations/003_create_pending_deposits_table.sql  # –î—É–±–ª–∏–∫–∞—Ç deposits
rm migrations/add_blockchain_transactions.sql  # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ game_bets/game_results:
**–í–∞—Ä–∏–∞–Ω—Ç –ê** - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
- –í `/api/admin/stats/+server.ts` –∑–∞–º–µ–Ω–∏—Ç—å `game_results` ‚Üí `game_bets`
- –í `/api/admin/game-stats/+server.ts` –∑–∞–º–µ–Ω–∏—Ç—å `game_results` ‚Üí `game_bets`

**–í–∞—Ä–∏–∞–Ω—Ç –ë** - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ –ë–î:
```sql
ALTER TABLE game_bets RENAME TO game_results;
```

### 3. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- `balance_operations` –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –≤—Å—è –ª–æ–≥–∏–∫–∞ –µ—Å—Ç—å –≤ `deposits`/`withdrawals`
- `pending_deposits` —Ç–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å - –¥—É–±–ª–∏—Ä—É–µ—Ç `deposits` —Å status='pending'

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–æ—Å—Ç–∞–≤–∏—Ç—å):
1. ‚úÖ `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
2. ‚úÖ `game_bets` - –°—Ç–∞–≤–∫–∏ –∏ –∏–≥—Ä—ã
3. ‚úÖ `star_transactions` - Telegram Stars –ø–ª–∞—Ç–µ–∂–∏
4. ‚úÖ `user_wallets` - TON –∫–æ—à–µ–ª—å–∫–∏
5. ‚úÖ `deposits` - TON –¥–µ–ø–æ–∑–∏—Ç—ã
6. ‚úÖ `withdrawals` - TON –≤—ã–≤–æ–¥—ã
7. ‚úÖ `ton_transactions` - –í—Å–µ TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
8. ‚úÖ `game_sessions` - –ò–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏
9. ‚úÖ `event_logs` - –õ–æ–≥–∏
10. ‚úÖ `user_settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –£–¥–∞–ª–∏—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å:
- ‚ùå `pending_deposits` - —É–¥–∞–ª–∏—Ç—å (–¥—É–±–ª–∏–∫–∞—Ç)
- ‚ùå `balance_operations` - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å (–¥—É–±–ª–∏—Ä—É–µ—Ç deposits/withdrawals)
- ‚ö†Ô∏è –ò—Å–ø—Ä–∞–≤–∏—Ç—å `game_results` ‚Üí `game_bets` –≤ –∫–æ–¥–µ
